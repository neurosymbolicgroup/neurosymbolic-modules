import numpy as np
from assembly_classifier import AssemblyClassifier

train_acts = np.load('data/new_representations/binary_digits_binary_pixels/train_activations.npy', allow_pickle=True).item()
test_acts = np.load('data/new_representations/binary_digits_binary_pixels/test_activations.npy', allow_pickle=True).item()
x_train, y_train = train_acts['fc2'], np.load("data/old_representations/binary_digits_all_pixels/y_train.npy")
x_test, y_test = test_acts['fc2'], np.load("data/old_representations/binary_digits_all_pixels/y_test.npy")

st = ('MT19937', np.array([ 639477924, 2632313678,  554955764, 4278433786, 1598237706,
        1860859797, 3090291271, 1333469415, 1983492490,  579848463,
        2944434478, 1288539865, 3484362557,  762987393, 3530963606,
        4029348230, 3786671412, 3611192675, 2129309775,  774258759,
         322940419, 3673494781, 3088033411, 3439058162, 2198037824,
        1695554567,  388364436,  478113939, 1893560941, 2446861802,
        3443838024, 4231207871, 2161871605, 3843284417, 2875228608,
        3478694232, 1122209251,  978650958, 2492361038,   78486321,
         144377727, 2782774643, 2034999517, 1435378756, 3732139929,
         445907043,  348702197,  487994723, 3578943573, 3393805402,
        1958131715,  154677140, 1782531753, 2128335701, 1362284786,
        2296888770, 2199674741, 3489260938, 4056330136,  815965192,
        1971863696,  849382660,  519114549, 3472732796, 1479196551,
           1293454, 3175348838, 3051448616, 1619053979, 3711808357,
        3457945148, 3837105031, 3041879550, 1584471026, 1266386323,
        2948727617, 3881843344,   98730190,  125258337, 4284992483,
         578100838, 1836112411, 1412574256,  400001456, 1132202492,
        3323403455, 2773102233, 2144731919,  329919994, 2189671826,
        4229047481, 1438272327, 3027961541, 1185273086, 3171197845,
        2377209053,  402488484, 3457164288, 1459833264, 2170726962,
         880670949, 1809405214,  848888171, 3200017597,   79767721,
         561038098, 1640424715, 1823804395, 3130160151, 2451113072,
        3147249201, 2684263153, 3325307537, 1009601181, 3431335603,
        4184748140, 3884031022, 3670805718, 2296010641, 3094318746,
        2947708814, 2786922365, 1152007888, 2463324412,  464913746,
         987954014, 3516147403, 3906756229,  131562306,  687741254,
         728733929, 4112775527,  227618755, 2733500630, 4032546709,
         973889996, 2875827631, 4139057900, 1974688734, 2190733898,
        3014690839, 3915983811, 3774101667, 1981125061, 1382567211,
        2276549785, 3214587509,  679522106,   92548215, 4242480766,
        1422122283,  735043037, 3149745110, 3106828449, 2609159496,
        3867223237, 2541710692, 4215503637, 2296490634, 3515489907,
         150181338, 3894904369, 3721166254, 1780975746, 2024899850,
         664883791, 3759737935, 1127657268, 2811845979, 3750863167,
        1653645948, 1952614297, 1086259535, 2385811602, 1251225631,
        4216180062,  528706124, 1633210759, 1069017284, 4049537535,
         754493510,  142997049, 2515578385, 3219049821,  193740469,
        3474048560,  589309415, 3071787769,   44097597, 1344866004,
        2523770655, 3637496805, 1753345673, 2658669049, 1156429070,
        2564786010, 2697106187, 3271232367, 3516134626,  947707698,
        3486254644, 1515951773, 1892608698,  516460378, 1999299263,
         328760499, 4137663020, 3248250447, 1140784229,  727087515,
        3297083030, 1164716844, 2623882043, 4182399759, 3703889567,
        2747309111,  366231841, 1143323859, 2357396713, 3782583106,
        2508194223,  155049745, 3212378218, 1126522079,  710018271,
        3151794995, 3767526201, 2151808137, 2454525753, 1005690973,
        2865783082, 3742620565, 2561283014,  150095140, 3641498546,
        2105616633, 1462572120, 1208694875,   98800404,  676135603,
         522296622, 2315871881, 2522511856, 3259716484, 2310550316,
        2827564593, 2567083349,  943836904, 3068947071, 4220353775,
         677161703, 1816009502, 3135730996,  955569839, 1903834815,
         619733080, 3240321555,   77109255, 4218115499, 1633446346,
        1120490701,  834354577, 1278177556, 3200903511, 2977867197,
        4085117179, 3366661734, 2414916135,  620786168, 3060590519,
        1958890226, 2171212887,  322244536, 1338948847, 3665809657,
        3371586273, 1433641498, 2616018857, 2696792607, 2311685514,
        2808989774, 1836128155, 2643106227, 1915113947, 2327670109,
        3125179052, 2188335322, 3157487047, 2610567102, 3174904671,
        1400044593, 1260310053, 4262594780, 3820011419,   70867575,
        1489446874, 2487798266, 1110206046,  289574024, 3552741474,
        3655083420, 2969321544, 3074413592, 3603272081, 1347359382,
        3681555797,  777164936,  176488925, 4082735565, 2133545990,
        4029025749, 2309122270, 1631460635, 2142992052, 1256420510,
        2557732491, 1046821425,  805793840, 1483478599, 3239389917,
         953442106, 3782720097, 2527975641, 2589515862, 2505542656,
        1492775743,  610180371,  531581803, 2691033506, 3240935472,
        4249140764, 2683065478,  781905212, 2126289240,  970345384,
         108196115,  770387621,  725227761, 3689187560,  994233496,
        3293013119, 2595691170, 2101661155,  435015189, 1569598329,
        1013339208, 3553207727, 1702223293, 3286132523, 2947285074,
         533242773, 4133954566, 2479654333, 1043820256, 3800181402,
         989166926, 3366089744, 3436394954,  779500599,  234056243,
        4253756941, 1704178849, 1362321266,  346247607, 3465632288,
        4035944635,  446546398, 2391773591, 3835362859, 3159739772,
        3960270000, 3180153503, 3808767351, 2935347261,  314479627,
        1926875542, 1831500319,  861831811, 4262294976,   78212609,
        3353205930, 2216550795, 1606558478, 2629475991, 1528993967,
         226768125, 2208304747, 1826988022,  205297312,  498039416,
        3077877836, 1623698411, 3133129767, 2915968361, 1637747482,
        1963194162, 2769605563, 2456082374, 1404995266, 1874859036,
        1088352371, 3152932980,   62531896, 3280704061, 1586386323,
         499580539, 4203234897, 3080063406, 1604037189,  219810107,
        1440693181, 1577844347,  376880797,  458557831, 1874443212,
        2087075998,  729784443,  955876687, 2490572782, 2633035508,
        3862331875,  725207897, 4015241452, 3144425211,   66851196,
         298020162, 2518696192, 1729178421,  100589419, 3345851202,
        2485290097, 2991238132, 1814865499,  930708645, 1898496765,
        2121293912, 1424710311, 4075641262, 3421962119, 2872469237,
        2316745691, 4264829674, 1986108588,   28351185, 1993788552,
        1907055878, 3945979910, 4275518077, 2775820926, 1980396241,
        1809372261,  128836275, 2148465290, 2958627124, 1705621404,
        3791352603, 1950360667, 1135693859, 3796771566, 3077888356,
        2515635694, 3154432122, 2565413868, 3582160228, 3719179559,
        3446903227, 4097358143, 3492208866, 2030693903, 4219460361,
        3017932391,  701988053, 4021283576, 2999742099, 3149511074,
        1807050498, 3360110089, 3822026301, 3917399889, 1415444215,
        3720266385, 1729914306,  772843471, 1345232815,  744042082,
        2625719866,  351901445, 3881833683, 2664523316,  659113534,
        1950006691,  829686998,  479120812, 1107633550, 1399994049,
         538651852, 3660157864,  920342254, 1666809186, 3237224072,
         576894905, 2932070018, 2493945338, 3134803260, 3799196860,
         549886821, 2284035656,  847349287, 2939011980, 3428027864,
        1190041706, 3737164454, 2569219731, 2081205266, 2017509377,
        3380566902, 1846210689, 2318508490, 3269589771,  687791556,
        3815376007, 1037300926, 2147840573,  147247697, 2991325520,
        1150123867, 1950162869, 1609763242, 2754066769,  877656639,
        1529596163, 3118109961, 2317326736, 2839414118, 4084590657,
        3727655740, 3901956023, 2356633699, 1302715145, 3853683048,
        3462169040, 2280359895,  927824660, 2771962016, 1018460089,
        3529298683, 2599720822, 2328883382,  582471014, 3018196670,
        3055391241, 4003272417, 2658691566, 2087017810,  320592296,
        1573327181, 2087872237, 1861348594, 2079711184, 2573340153,
        1565624597, 1271937116, 3588610287, 2749055408, 1881923837,
         691500531,  931955589, 1448511216, 4036931861, 1266907530,
        3854406173,  909403091, 1331995794, 2813803117, 3791370638,
        1027922831, 2125847390,  664127900, 1715660129, 1789963699,
        2321225648, 1174112948, 2629788633, 1141259900, 1853930316,
        2615659151, 2861908506, 2957950598, 1663412014, 1641279171,
        1356951531,  512123390, 3135013775, 2762743631, 1986782317,
         488798753,  172104608, 2454136924, 2418763349,  445896362,
        3912478284, 3939679237, 3897287127, 1956329160, 3024497449,
        3653183606, 1861996989, 3594031183, 3295715754,  540941767,
         775193099, 1020902984, 1371198976, 1643818386,  865213215,
        1173097697,  291966039, 1505340951, 2247661345, 2958299675,
        2800664994,  351135082, 2219973016, 3055159273], dtype=np.uint32), 623, 0, 0.0)

np.random.set_state(st)
d, p, reps = x_train.shape[1], 0.1, 10
AC = AssemblyClassifier(d, n_assembly=1000, n_cap=41, edge_prob=p, initial_projection=True)
correct = AC.accuracy(x_test, y_test)
total = len(y_test)
print("-----PRE-TESTING-----")
print('Accuracy of the network on the test set: %d / %d = %.2f %%' % (correct, total, 100.*correct/total))
# pre_acts = AC.get_output_activities(x_test)

print("-----TRAINING-----")
n_train = 1000
AC.train(x_train[:n_train], y_train[:n_train])

correct = AC.accuracy(x_test, y_test)
total = len(y_test)
print("-----POST-TESTING-----")
print('Accuracy of the network on the test set: %d / %d = %.2f %%' % (correct, total, 100.*correct/total))
